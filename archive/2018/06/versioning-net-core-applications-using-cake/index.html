
<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width" />
     <link rel="shortcut icon" href="/images/favicon.ico">
    <meta http-equiv="last-modified" content="2020-05-07T21:11:48.9912439+01:00" />
    <meta name="keywords" content="Cake,.net,.net Core" />
	
    <link rel="alternate" type="application/rss+xml" title="RSS - Guilherme Ferreira Blog" href="/rss.xml" />
    <link rel="alternate" type="application/atom+xml" title="Atom - Guilherme Ferreira Blog" href="/feed.xml" />
	
    <title>
            Versioning .net Core applications using Cake - 
        Guilherme Ferreira
    </title>
    <meta name="description" content="Guilherme Ferreira blog - Developer, Entrepreneur, Foodie, Addicted to coffee">
    <link rel="stylesheet" type="text/css" href="/stylesheets/font-awesome/css/font-awesome.min.css" />
    <link rel="stylesheet" type="text/css" href="/stylesheets/style.css" />
    <link rel="canonical" href="http://gsferreira.com/archive/2018/06/versioning-net-core-applications-using-cake/" />
</head>
<body class="home blog">
    <div id="page" class="hfeed site">
        
	<header id="masthead" class="simple-header" role="banner">
	<hgroup>
		<a href="/" title="Home"><img width="40" height="40" src="/images/logo.jpg" title="logo"  alt="logo"></a>
		<h1 class="site-title"><a href="/" title="Snow Byte" rel="home">Guilherme Ferreira</a>
	</hgroup>
</header>
        

        <div id="main">
            <div id="primary" class="site-content">
                <div id="content" role="main">
                  


<div class="post">
    <h1>Versioning .net Core applications using Cake</h1> 
      <div class="meta">
        <p class="posted">27 Jun 2018</p>
        <ul class="categories">
          <li><a href="/category/cake" title="Snow.Models.Category">Cake</a></li>
          <li><a href="/category/.net" title="Snow.Models.Category">.net</a></li>
          <li><a href="/category/.net-core" title="Snow.Models.Category">.net Core</a></li>
        </ul>
      </div>
    </div>
    
    
        
    <p>If you are moving to .net Core and you want to implement a versioning strategy in your application, now you have an awesome alternative to the good old fellow "AssemblyInfo". </p>

<p>The alternative is the <a href="https://docs.microsoft.com/en-us/visualstudio/msbuild/customize-your-build"><em>Directory.build.props</em></a> file. If you place these file in the root folder that contains your source code, when MSBuild runs will add to every project the properties defined in the <em>Directory.build.props</em>.</p>

<p>In this post, we will see how to quickly setup a solution with multiple projects and use <em>Directory.build.props</em> with <a href="http://cakebuild.net">Cake</a> to build and increment the version number.</p>

<!--excerpt-->

<p><img src="/images/versioning-a-net-core-applications-using-cake-directory-build-props.png" alt="Directory.build.props" /></p>

<h2>Setup your project</h2>

<p>Let's use the <a href="https://docs.microsoft.com/en-us/dotnet/core/tools/?tabs=netcore2x">.net Core CLI</a> to quickly accomplish this task.</p>

<p>Start by creating a folder in your computer and then open the command line and go to the directory that you just created. Then execute the following commands.</p>

<ol>
<li>Create a Solution: <code>dotnet new sln --name DotNetCoreVersioning</code></li>
<li>Create a console application and place it in the <em>src</em> folder: <code>dotnet new console --name Application --output src\Application</code></li>
<li>Create a class library and place it in the <em>src</em> folder: <code>dotnet new classlib --name Library --output src\Library</code></li>
<li>Add the console application to the solution: <code>dotnet sln add .\src\Application\Application.csproj</code></li>
<li>Add the class library to the solution: <code>dotnet sln add .\src\Library\Library.csproj</code></li>
<li>Build it: <code>dotnet build</code></li>
</ol>

<p>If you go to the folder you will see a solution file that you can open in Visual Studio.</p>

<h2>Adding the <em>Directory.build.props</em></h2>

<p>Now it's time to add the file that will do the magic. </p>

<p>You just need to create a file with the name <em>Directory.build.props</em> inside the <em>src</em> folder.</p>

<p>Add it and then copy the following snippet into it.</p>

<pre><code>&lt;Project&gt;
&lt;PropertyGroup&gt;
    &lt;Company&gt;Empire&lt;/Company&gt;
    &lt;Version&gt;1.0.1&lt;/Version&gt;
    &lt;AssemblyTitle&gt;Death Star - Superlaser&lt;/AssemblyTitle&gt;
&lt;/PropertyGroup&gt;
&lt;/Project&gt;  
</code></pre>

<p>If you run the <code>dotnet build</code> command and go to the bin folder, of the console application or the class library, you can see in the DLL details that now the version is 1.0.1.</p>

<h2>Incrementing the version number.</h2>

<p>In this example, I will use a simple Cake script to increment the version number. </p>

<h3>Setup your build script</h3>

<p>I will explain how to do that manually, but if you are a <a href="https://code.visualstudio.com/">Visual Studio Code</a> user I highly recommend that you install the cake extension and use the tools provided by the extension.</p>

<ol>
<li><p>Install the Cake bootstrapper. You can find <a href="https://cakebuild.net/docs/tutorials/setting-up-a-new-project">here</a> how to do that. </p></li>
<li><p>Create a <em>build.cake</em> file next to the bootstrapper.</p></li>
<li><p>Add the following snippet to the build.cake.</p></li>
</ol>

<p>&nbsp;</p>

<pre><code>///////////////////////////////////////////////////////////////////////////////
// ARGUMENTS
///////////////////////////////////////////////////////////////////////////////

var target = Argument("target", "Default");
var configuration = Argument("configuration", "Release");

///////////////////////////////////////////////////////////////////////////////
// TASKS
///////////////////////////////////////////////////////////////////////////////

Task("Version")
    .Does(() =&gt; {

});

Task("Build")
    .IsDependentOn("Version")
    .Does(() =&gt; {
        DotNetCoreBuild("./DotNetCoreVersioning.sln");
});

Task("Default")
    .IsDependentOn("Build");

RunTarget(target);
</code></pre>

<p>Your build has now two steps and is building your solution using <em>DotNetCoreBuild</em>.</p>

<h3>Increment the version number</h3>

<p>To increment the version number we need to update the <em>Directory.build.props</em> file. </p>

<p>Since the <em>props</em> file is an XML we can use the Cake <a href="https://cakebuild.net/dsl/xml/">XML aliases</a> like XmlPeek and XmlPoke to read and update the version number.</p>

<p><strong>Note:</strong> <em>I recommend you to use the Build Number of your build server to calculate the new version number. In this case, we will read the current version from the file content.</em></p>

<p>Go ahead and copy the following snippet into the <em>Version</em> task in your <em>build.cake</em> file.</p>

<pre><code>var propsFile = "./Directory.build.props";
var readedVersion = XmlPeek(propsFile, "//Version");
var currentVersion = new Version(readedVersion);

var semVersion = new Version(currentVersion.Major, currentVersion.Minor, currentVersion.Build + 1);
var version = semVersion.ToString();

XmlPoke(propsFile, "//Version", version);
</code></pre>

<p>As you can see, we are reading the version property, incrementing the build number and then updating the <em>props</em> file again.</p>

<h3>The result</h3>

<p>Now that our build script is completed, go ahead and run your Cake bootstrapper (<em>build.ps1</em> or <em>build.sh</em>) and you will see that the compiled DLLs from all the projects have the version incremented.</p>

<p>You can use the <em>Directory.build.props</em> to customize other project properties, not only for versioning.</p>

<p>Go ahead and give it a try.</p>



	<div class="post-social-links">
        <a href="http://twitter.com/gsferreira"><img src="/images/000-twitter-bird-48.png" title="gsferreira"/></a>
        <a href="http://gsferreira.com/rss.xml"><img src="/images/000-rss-feeds-48.png" title="gsferreira.com feed" onClick="_gaq.push(['_trackEvent', 'Post', 'RssSubscribe', 'Rss Subscribe on Post']);"/></a>
    </div>
	<div class="addthis_toolbox addthis_default_style" style="float:right;">
        <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
        <a class="addthis_button_tweet"></a>
        <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
        <a class="addthis_button_linkedin_counter"></a>
        <a class="addthis_counter addthis_pill_style"></a>
    </div>
	
    <div id="disqus_thread"></div>
<script>
    var reset_disqus = function(){
        DISQUS.reset({
            reload: true,
            config: function () {
                //this.page.identifier = '';
                this.page.url = 'http://gsferreira.com/archive/2018/06/versioning-net-core-applications-using-cake/';
                //this.page.title = '';
            }
        });
    };

    var disqus_shortname = 'gsferreira';
    var disqus_url = 'http://gsferreira.com/archive/2018/06/versioning-net-core-applications-using-cake/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    window.addEventListener('orientationchange', reset_disqus);
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-****"></script>


                </div>
                <!-- #content -->
            </div>
            <!-- #primary .site-content -->
        </div>
        <!-- #main -->

        <footer class="site-footer" role="contentinfo">
            <div class="site-info">
                Powered by <a href="https://github.com/Sandra/Sandra.Snow" rel="generator">Sandra.Snow</a> using <a href="https://github.com/gsferreira/letsnow" rel="generator">letsnow theme</a>.	
            </div>
            <!-- .site-info -->
        </footer>
        <!-- #colophon .site-footer -->
    </div>
    <!-- #page .hfeed .site -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src='/javascripts/prettify.js' type='text/javascript'></script>
    
    <script type="text/javascript">
var _gaq = _gaq || [];

_gaq.push(['_setAccount', 'UA-33436813-1']);
_gaq.push(['_trackPageview']);
        
(function () {
    var ga = document.createElement('script');
    ga.type = 'text/javascript';
    ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(ga, s);
})();
</script>
    
    <script type='text/javascript'>
      $(function () {
        $("pre code").parent().each(function () {
          if (!$(this).hasClass("prettyprint")) {
            $(this).addClass("prettyprint");
            a = true
          }
        });

        prettyPrint();
      });
    </script>
</body>
</html>
