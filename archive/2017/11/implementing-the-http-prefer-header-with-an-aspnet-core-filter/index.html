<!doctype html><html lang="en" class="font-normal font-sans leading-relaxed antialiased"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="theme-color" content="#ffffff"><base href="/archive/2017/11/implementing-the-http-prefer-header-with-an-aspnet-core-filter/"><meta name="description" content="Guilherme Ferreira - Minimalist developer"><meta name="robots" content="index,follow"><meta name="googlebot" content="index,follow"><meta name="google" content="nositelinkssearchbox"><meta name="generator" content="eleventy"><meta name="format-detection" content="telephone=no"><link rel="canonical" href="https://gsferreira.com/archive/2017/11/implementing-the-http-prefer-header-with-an-aspnet-core-filter/"><title>Implementing the HTTP Prefer Header with an ASP.NET Core Filter Guilherme Ferreira - Minimalist developer</title><link rel="shortcut icon" href="/images/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"><link rel="manifest" href="/images/site.webmanifest"><meta property="og:url" content="https://gsferreira.com/archive/2017/11/implementing-the-http-prefer-header-with-an-aspnet-core-filter/"><meta property="og:type" content="website"><meta property="og:title" content="Implementing the HTTP Prefer Header with an ASP.NET Core Filter"><meta property="og:image" content="https://gsferreira.com/images/logo.jpg"><meta property="og:description" content="Guilherme Ferreira - Minimalist developer"><meta property="og:site_name" content="Guilherme Ferreira - Minimalist developer"><meta property="og:locale" content="en_GB"><meta property="article:author" content="Guilherme Ferreira"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@gsferreira"><meta name="twitter:creator" content="@gsferreira"><meta name="twitter:description" content="Software Architect | @netponto Team | Father &amp; Husband 👨‍👩‍👧 | Black Lab Companion 🐶 | Ankylosing Spondylitis 💊 | Minimalism 🌱 | Continuous improvement"><meta name="twitter:image" content="https://gsferreira.com/images/logo.jpg"><meta name="twitter:title" content="Guilherme Ferreira"><meta name="twitter:dnt" content="on"><script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-33436813-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-33436813-1")</script><style>/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}a{background-color:transparent}strong{font-weight:bolder}code{font-family:monospace,monospace;font-size:1em}small{font-size:80%}img{border-style:none}button,input,select{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}progress{vertical-align:baseline}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}details{display:block}summary{display:list-item}template{display:none}[hidden]{display:none}figure,h1,h2,h3,h4,p{margin:0}button{background-color:transparent;background-image:none;padding:0}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}ul{list-style:none;margin:0;padding:0}html{font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.5}*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#d2d6dc}img{border-style:solid}input::-moz-placeholder{color:#a0aec0}input:-ms-input-placeholder{color:#a0aec0}input::-ms-input-placeholder{color:#a0aec0}input::placeholder{color:#a0aec0}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}button,input,select{padding:0;line-height:inherit;color:inherit}code{font-family:Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}:root{--measure:48rem;--flow-space:1.5em;--color-bodybg:#ffffff;--color-bodytext:#364152;--color-muted:#f9fafb;--color-primary:#047481;--color-secondary:#0694a2;--color-links:var(--color-primary);--color-focus:var(--color-secondary);--form-shadow:0 2px 15px 0 rgba(210, 214, 220, 0.5)}.dark-mode{--color-bodybg:#1a202e;--color-bodytext:#e2e8f0;--color-muted:#27303f;--color-primary:#16bdca;--color-secondary:#7edce2;--form-shadow:0 2px 15px 0 rgba(26, 26, 27, 0.637)}:root{-webkit-overflow-scrolling:touch;scroll-behavior:smooth;text-rendering:optimizeSpeed}::selection{color:#fff;background-color:var(--color-primary)}button:focus{outline:1px solid var(--color-focus);outline-offset:.1rem}section{padding-left:1.5rem;padding-right:1.5rem;padding-top:4rem;padding-bottom:4rem}h1,h2,h3,h4{font-weight:700;line-height:1.25;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji"}h1{font-size:3rem}h2{font-size:2.25rem}h3{font-size:1.875rem}h4{font-size:1.5rem}@media (min-width:768px){h1{font-size:4rem}h2{font-size:3rem}h3{font-size:2.25rem}h4{font-size:1.875rem}}a:not([class]){-webkit-text-decoration-line:underline;text-decoration-line:underline;-webkit-text-decoration-skip:ink;text-decoration-skip-ink:auto;-webkit-text-decoration-color:var(--color-links);text-decoration-color:var(--color-links);text-decoration-thickness:2px;text-underline-offset:3px}a:not([class]):hover{color:var(--color-links)}.flow{max-width:var(--measure)}.flow>*+*{margin-top:1.5em;margin-top:var(--flow-space)}.flow>p+p{--flow-space:1em}.flow>h1+p,.flow>h2+p,.flow>h3+p,.flow>h4+p{--flow-space:1.25em}.measure{max-width:var(--measure)}.markdown ul{list-style-type:disc;list-style-position:inside}.container{width:100%;margin-right:auto;margin-left:auto}@media (min-width:640px){.container{max-width:640px}}@media (min-width:768px){.container{max-width:768px}}@media (min-width:1024px){.container{max-width:1024px}}@media (min-width:1280px){.container{max-width:1280px}}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}.focus\:not-sr-only:focus{position:static;width:auto;height:auto;padding:0;margin:0;overflow:visible;clip:auto;white-space:normal}.bg-gray-500{background-color:#6b7280}.bg-bodybg{background-color:var(--color-bodybg)}.bg-muted{background-color:var(--color-muted)}.bg-primary{background-color:var(--color-primary)}.hover\:bg-secondary:hover{background-color:var(--color-secondary)}.focus\:bg-primary:focus{background-color:var(--color-primary)}.border-transparent{border-color:transparent}.border-cool-gray-100{border-color:#f1f5f9}.border-primary{border-color:var(--color-primary)}.hover\:border-cool-gray-700:hover{border-color:#364152}.focus\:border-cool-gray-700:focus{border-color:#364152}.dark-mode .dark\:border-gray-700{border-color:#374151}.dark-mode .dark\:border-cool-gray-800{border-color:#27303f}.rounded-full{border-radius:9999px}.border{border-width:1px}.border-b-2{border-bottom-width:2px}.border-t{border-top-width:1px}.border-b{border-bottom-width:1px}.cursor-not-allowed{cursor:not-allowed}.block{display:block}.flex{display:flex}.grid{display:grid}.table{display:table}.hidden{display:none}.flex-row{flex-direction:row}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-center{align-items:center}.justify-center{justify-content:center}.flex-grow{flex-grow:1}.font-sans{font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji"}.font-light{font-weight:300}.font-normal{font-weight:400}.font-semibold{font-weight:600}.font-bold{font-weight:700}.font-black{font-weight:900}.h-3{height:.75rem}.h-6{height:1.5rem}.leading-5{line-height:1.25rem}.leading-relaxed{line-height:1.625}.mx-4{margin-left:1rem;margin-right:1rem}.my-auto{margin-top:auto;margin-bottom:auto}.mx-auto{margin-left:auto;margin-right:auto}.mt-1{margin-top:.25rem}.mt-2{margin-top:.5rem}.mb-2{margin-bottom:.5rem}.mt-6{margin-top:1.5rem}.ml-6{margin-left:1.5rem}.mt-8{margin-top:2rem}.mt-10{margin-top:2.5rem}.mt-16{margin-top:4rem}.mt-20{margin-top:5rem}.mb-20{margin-bottom:5rem}.ml-auto{margin-left:auto}.-mb-px{margin-bottom:-1px}.min-h-screen{min-height:100vh}.opacity-50{opacity:.5}.focus\:outline-none:focus{outline:0}.overflow-hidden{overflow:hidden}.overflow-x-hidden{overflow-x:hidden}.p-2{padding:.5rem}.p-6{padding:1.5rem}.px-1{padding-left:.25rem;padding-right:.25rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.px-4{padding-left:1rem;padding-right:1rem}.py-6{padding-top:1.5rem;padding-bottom:1.5rem}.px-8{padding-left:2rem;padding-right:2rem}.static{position:static}.absolute{position:absolute}.relative{position:relative}.sticky{position:-webkit-sticky;position:sticky}.top-0{top:0}.text-center{text-align:center}.text-white{color:#fff}.text-gray-500{color:#6b7280}.text-gray-600{color:#4b5563}.text-bodytext{color:var(--color-bodytext)}.text-primary{color:var(--color-primary)}.hover\:text-secondary:hover{color:var(--color-secondary)}.focus\:text-white:focus{color:#fff}.dark-mode .dark\:text-cool-gray-900{color:#1a202e}.text-sm{font-size:.875rem}.text-base{font-size:1rem}.text-lg{font-size:1.125rem}.text-2xl{font-size:1.5rem}.uppercase{text-transform:uppercase}.antialiased{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.tracking-wider{letter-spacing:.05em}.visible{visibility:visible}.invisible{visibility:hidden}.whitespace-no-wrap{white-space:nowrap}.w-3{width:.75rem}.w-6{width:1.5rem}.z-10{z-index:10}.transform{--transform-translate-x:0;--transform-translate-y:0;--transform-rotate:0;--transform-skew-x:0;--transform-skew-y:0;--transform-scale-x:1;--transform-scale-y:1;transform:translateX(var(--transform-translate-x)) translateY(var(--transform-translate-y)) rotate(var(--transform-rotate)) skewX(var(--transform-skew-x)) skewY(var(--transform-skew-y)) scaleX(var(--transform-scale-x)) scaleY(var(--transform-scale-y))}.fade-in-down{-webkit-animation:fadeInDown .7s ease both;animation:fadeInDown .7s ease both}@keyframes fadeInDown{0%{opacity:0;transform:translateY(-20px)}100%{opacity:1;transform:translateY(0)}}.sun-icon{display:none}.dark-mode .sun-icon{display:block}.dark-mode .moon-icon{display:none}a[rel~=external]::after{content:"↗";font-family:system-ui,-apple-system,sans-serif;font-style:normal;font-weight:900;color:currentColor;padding-left:.2em;line-height:.75;-webkit-text-decoration-line:none;text-decoration-line:none}@media (min-width:640px){.sm\:h-12{height:3rem}.sm\:visible{visibility:visible}.sm\:w-12{width:3rem}}@media (min-width:768px){.md\:ml-12{margin-left:3rem}.md\:text-xl{font-size:1.25rem}}</style></head><body class="bg-bodybg text-bodytext text-lg md:text-xl overflow-x-hidden flex flex-col min-h-screen"><a class="text-center sr-only focus:not-sr-only focus:outline-none focus:bg-primary focus:text-white" href="#main-content">Skip to content</a><div class="sticky top-0 z-10 bg-bodybg text-bodytext border-b border-cool-gray-100 dark:border-cool-gray-800 px-4 tracking-wider"><nav class="flex items-center mx-auto measure"><a href="/" class="p-2"><img src="/images/logo-small.jpg" alt="Guilherme Ferreira" class="rounded-full w-3 h-3 sm:h-12 sm:w-12 flex items-center justify-center invisible sm:visible"> <span class="sr-only">Go back to homepage</span></a><div class="flex items-center ml-auto -mb-px"><a href="/" class="px-1 py-6 leading-5 whitespace-no-wrap border-b-2 border-transparent focus:outline-none hover:border-cool-gray-700 focus:border-cool-gray-700 ml-6 md:ml-12">Home</a> <a href="/blog/" class="px-1 py-6 leading-5 whitespace-no-wrap border-b-2 border-transparent focus:outline-none hover:border-cool-gray-700 focus:border-cool-gray-700 ml-6 md:ml-12">Blog</a> <a href="/about/" class="px-1 py-6 leading-5 whitespace-no-wrap border-b-2 border-transparent focus:outline-none hover:border-cool-gray-700 focus:border-cool-gray-700 ml-6 md:ml-12">About</a> <button id="dark-mode-toggle" class="p-2 ml-6 md:ml-12"><svg aria-hidden="true" fill="currentColor" viewBox="0 0 20 20" class="w-6 h-6 moon-icon"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg> <svg aria-hidden="true" fill="currentColor" viewBox="0 0 20 20" class="w-6 h-6 sun-icon"><path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd"></path></svg> <span class="sr-only">Button to switch between dark and light theme</span></button></div></nav></div><main id="main-content" style="scroll-margin-top:5rem" class="flex flex-col flex-grow"><section><article class="mx-auto measure markdown"><time value="Wed Nov 15 2017 00:00:00 GMT+0000 (Coordinated Universal Time)" class="text-sm text-gray-600">Last updated: 15 November 2017</time><h1 class="mt-6">Implementing the HTTP Prefer Header with an ASP.NET Core Filter</h1><div class="mt-6 text-2xl text-gray-500 flow"></div><div class="mt-8 flow"><p>Have you heard about <strong>Prefer Header for HTTP</strong>? The <a href="https://tools.ietf.org/html/rfc7240">RFC-7240</a> defines how this header can be used by a client, in order to request that certain behaviors be employed by a server while processing a request.</p><p>Why does it matter? You probably have consumed API's where you use the HTTP POST or PUT method to modify a resource and the server returns a complete representation of the resource. In other cases the API only returns the Identifier of the resource created, for example.</p><p><strong>What if you want to defer to the client to specify which optional behavior is preferred?</strong> That's why you need to know about the HTTP Prefer Header.</p><p>The RFC specifies a group of Preference Definitions like a preference to indicate that the client prefers the server to respond asynchronously to a response for example, but this post will be focused on the &quot;return=representation&quot; and &quot;return=minimal&quot; preferences.</p><h2>&quot;return=representation&quot;</h2><blockquote><p>The &quot;return=representation&quot; preference indicates that the client prefers that the server include an entity representing the current state of the resource in the response to a successful request.</p></blockquote><h2>&quot;return=minimal&quot;</h2><blockquote><p>The &quot;return=minimal&quot; preference, on the other hand, indicates that the client wishes the server to return only a minimal response to a successful request.</p></blockquote><p>This preference is really useful when dealing with replies to a POST, PUT or PATCH request.</p><p><strong>The selection of which type of response to return to client have impact on what a client must do after receiving the response.</strong> Example: by returning a representation of the resource in the response the client won't need to do an additional GET request.</p><h1>How to implement in ASP.NET Core?</h1><p>One of the first questions that I faced when trying to implement the prefer header was <em>&quot;how to implement it in ASP.NET Core?&quot;</em>.</p><p>The easy answer would be:</p><ul><li>Do it in your Controller Action. Easy peasy, right?</li></ul><p>Not so sure my friend!</p><p>Following that approach will be difficult to manage when you face yourself with dozens of Controllers each one with a POST and a PUT. Now you see it... the beauty of the duplicated code :)</p><p>So, what if we write an ASP.NET Core filter?</p><blockquote><p>If you don't know what is a Filter I recommend you to go read <a href="https://docs.microsoft.com/en-us/aspnet/mvc/overview/older-versions-1/controllers-and-routing/understanding-action-filters-cs">here</a>.</p><p>If you find yourself wondering why don't create a Middleware, please see this <a href="https://channel9.msdn.com/Series/aspnetmonsters/ASPNET-Monsters-91-Middleware-vs-Filters">awesome video</a>.</p></blockquote><h2>Setup</h2><p>In my implementation, I defined that DTOs that can be controlled by the &quot;return=minimal&quot; preference should implement an interface <em>&quot;IIdentifiable&quot;</em>. That interface specifies the properties that I need to return in the &quot;minimal&quot; version (an Id for instance).</p><p>So, go ahead and create an <em>IIdentifiable</em> interface and add it to your DTO.</p><h2>The filter</h2><p>I implemented an Action Filter that will only return the full object when the client sends the <em>&quot;return=representation&quot;</em> preference.</p><p>So the flow is something like:</p><ol><li>POST a new Resource</li><li>Handle the request</li><li>Return an Action Result with a DTO in it</li><li>Catch the response in a filter<ul><li>The Request doesn't have the Prefer header?</li><li>The Request has the Prefer header without the value &quot;return=representation&quot;?</li><li>If the answer to any of the previous questions is &quot;Yes&quot;, I update the result to a new object with the minimal information.</li></ul></li></ol><p>The filter:</p><script src="https://gist.github.com/gsferreira/80aa93d12633c0df271a08f6dc2e52ca.js?file=HttpPreferReturnHeaderFilterAttribute.cs"></script><p><em>As you can see I am creating a new IdentifiableDto. That class is just a simple implementation of the IIdentifiable interface. If you prefer, you can just return a dynamic object.</em></p><p>Now you can use it in your Controllers like this:</p><script src="https://gist.github.com/gsferreira/80aa93d12633c0df271a08f6dc2e52ca.js?file=Controller.cs"></script><p><strong>*Note:</strong> If you need to do an extra effort to load the resource from the database, probably the Filter approach isn't the best fit for you.*</p></div><nav class="mx-auto mt-16 measure"><a href="/blog/">← Blog index</a></nav><div class="flex flex-row justify-center mt-20"><script async="async" data-uid="6b1314a04e" src="https://gsferreira.ck.page/6b1314a04e/index.js"></script></div><div id="disqus_thread"></div><script>var disqus_config=function(){this.page.url="https://gsferreira.com/archive/2017/11/implementing-the-http-prefer-header-with-an-aspnet-core-filter/"};!function(){var e=document,t=e.createElement("script");t.src="https://gsferreira.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)}()</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></article></section></main><footer class="border-t border-cool-gray-100 dark:border-gray-700 bg-muted"><div class="p-6 mx-auto overflow-hidden text-base measure"><div class="flex flex-wrap justify-center mt-2"><div class="px-8"><a rel="external" href="https://twitter.com/gsferreira">Twitter</a></div><div class="px-8"><a rel="external" href="https://github.com/gsferreira">GitHub</a></div><div class="px-8"><a href="/feed.xml">RSS</a></div></div><div class="mt-6 mb-2"><p class="text-center text-gray-500">&copy; Guilherme Ferreira</p><p class="text-center text-gray-500">POWERED BY <a href="https://www.11ty.dev/" title="11TY">11TY</a></p></div></div></footer><script>let darkMode=localStorage.getItem("darkMode");const darkModeToggle=document.querySelector("#dark-mode-toggle"),enableDarkMode=()=>{document.querySelector("html").classList.add("dark-mode"),localStorage.setItem("darkMode","enabled")},disableDarkMode=()=>{document.querySelector("html").classList.remove("dark-mode"),localStorage.setItem("darkMode",null)};"enabled"===darkMode&&enableDarkMode(),darkModeToggle.addEventListener("click",()=>{darkMode=localStorage.getItem("darkMode"),"enabled"!==darkMode?enableDarkMode():(document.querySelector("html").classList.remove("dark-mode"),localStorage.setItem("darkMode",null))});</script></body></html>